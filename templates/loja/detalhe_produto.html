{% extends 'base.html' %}

{% block title %}{{ produto.nome }} - Fluorita{% endblock %}

{% block content %}
    <div style="display: flex; gap: 30px;">
        <div style="flex: 1;">
            {% if produto.imagem %}
                <img src="{{ produto.imagem.url }}" alt="{{ produto.nome }}" style="max-width: 100%;">
            {% endif %}
        </div>

        <div style="flex: 1;">
            <h1>{{ produto.nome }}</h1>
            <p><small>Categoria: {{ produto.categoria.nome }}</small></p>
            <p style="font-size: 24px; color: #333;"><strong>R$ {{ produto.preco }}</strong></p>
            <p>{{ produto.descricao }}</p>
            <hr style="margin-top: 40px;">
            <div class="avaliacoes-section">
                <h2>Avaliações de Clientes</h2>

                {% if pode_avaliar %}
                    <h3>Deixe sua avaliação</h3>
                    <form action="{% url 'loja:adicionar_avaliacao' produto.slug %}" method="POST">
                        {% csrf_token %}
                        {{ avaliacao_form.as_p }}
                        <button type="submit">Enviar Avaliação</button>
                    </form>
                    <hr>
                {% elif request.user.is_authenticated %}
                     <p><i>Você precisa ter comprado e recebido este produto para poder avaliá-lo.</i></p>
                {% else %}
                     <p><i><a href="{% url 'loja:login' %}?next={{ request.path }}">Faça o login</a> para avaliar este produto.</i></p>
                {% endif %}

                {% for avaliacao in avaliacoes %}
                    <div class="avaliacao" style="border-bottom: 1px solid #eee; padding: 15px 0;">
                        <strong>Nota: {{ avaliacao.get_nota_display }}</strong>
                        <p>"{{ avaliacao.comentario }}"</p>
                        <small>Por: {{ avaliacao.usuario.username }} em {{ avaliacao.criado_em|date:"d/m/Y" }}</small>
                    </div>
                {% empty %}
                    <p>Este produto ainda não tem avaliações. Seja o primeiro a avaliar!</p>
                {% endfor %}
            </div>
            <hr>
            <form action="{% url 'loja:adicionar_ao_carrinho' produto.id %}" method="POST">
                {% csrf_token %}
                <label for="quantidade-{{ produto.id }}">Quantidade:</label>
                <input type="number" name="quantidade" id="quantidade-{{ produto.id }}" value="1" min="1" max="{{ produto.estoque }}">
                <button type="submit">Adicionar ao Carrinho</button>
            </form>
        </div>
    </div>
    <br>
    <a href="{% url 'loja:lista_produtos' %}">Voltar para a lista de produtos</a>
{% endblock %}